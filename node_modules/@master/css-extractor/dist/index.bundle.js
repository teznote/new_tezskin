var M=Object.create;var x=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var L=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var N=(t,r)=>{for(var s in r)x(t,s,{get:r[s],enumerable:!0})},b=(t,r,s,e)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of G(r))!j.call(t,i)&&i!==s&&x(t,i,{get:()=>r[i],enumerable:!(e=W(r,i))||e.enumerable});return t};var d=(t,r,s)=>(s=t!=null?M(L(t)):{},b(r||!t||!t.__esModule?x(s,"default",{value:t,enumerable:!0}):s,t)),D=t=>b(x({},"__esModule",{value:!0}),t);var X={};N(X,{CSSExtractor:()=>f,OPTIONS_ESM_TEXT:()=>U,OPTIONS_TEXT:()=>B,default:()=>f,extractLatentClasses:()=>g,options:()=>u});module.exports=D(X);var z={verbose:1,module:".virtual/master.css",config:"master.css.*",sources:[],include:["**/*.{html,js,jsx,ts,tsx,svelte,astro,vue,md,mdx,pug,php}"],exclude:["**/*.css","**/*.d.ts","**/*.test.*","**/*test.{js,cjs,mjs,ts}","**/*.options.*","**/*master.css.*","**/*master.css-extractor.*","**/*master.css-renderer.*","**/*README.md","**/dist/**","**/out/**","**/styles/**","**/public/**","**/node_modules/webpack*/**","**/node_modules/events/**","**/node_modules/html-entities/**","**/node_modules/ansi-html-community/**","**/node_modules/util/**","**/node_modules/react/**","**/node_modules/react-dom/**","**/node_modules/vue/**","**/node_modules/next/**","**/node_modules/astro/**","**/node_modules/svelte/**","**/node_modules/svelte-hmr/**","**/node_modules/@swc/**","**/node_modules/@sveltejs/**","**/node_modules/@angular/**","**/node_modules/.cache/**","**/node_modules/.vite/**"],classes:{fixed:[],ignored:[]}},u=z;var B=`/** @type {import('@master/css-extractor').Options} */
module.exports = {
    sources: [],
    classes: {
        fixed: [],
        ignored: []
    }
}
`;var U=`/** @type {import('@master/css-extractor').Config} */
export default {
    sources: [],
    classes: {
        fixed: [],
        ignored: []
    }
}
`;var F=d(require("@master/css"));function g(t){t=q(t);let r=t.match(/\S+/g)??[],s=new Set;for(let e of r){for(let o of k(e))s.add(C(o));let i=T(e);if(i.size)for(let o of i)for(let n of k(o))s.add(C(n))}return Array.from(s).filter(e=>e&&!H(e))}var k=t=>y(t,s=>(s.match(/[^"'`]+/g)??[]).join("SPLIT_BY_THIS")).split("SPLIT_BY_THIS"),C=t=>{let r=t;return t=y(t,s=>s.replace(/^[^:@~(]*(?<!@>?)=/,"").replace(/[([{\\:#=.]+$/,"")),r===t||!t?t:C(t)},$=t=>t?.match(/((?<!\\)["'`])(?:\\\1|(?:(?!\1))[\S\s])*(?<!\\)\1/g),A=(t,r)=>(r?.forEach((s,e)=>{t=t.replace(s,`COMPLETE-STRING--${e}--`)}),t),y=(t,r)=>{let s=$(t);return t=A(t,s),t=r(t),s?.forEach((e,i)=>{t=t.replace(`COMPLETE-STRING--${i}--`,e)}),t},T=t=>{let r=new Set,s=/((?<!\\)["'`])((?:\\\1|(?:(?!\1))[\S\s])*)((?<!\\)\1)/g,e;for(;(e=s.exec(t))!==null;){e.index===s.lastIndex&&s.lastIndex++,r.add(e[2]);let i=T(e[2]);if(i.size)for(let o of i)r.add(o)}return r},q=t=>y(t,r=>r.replace(/\/\*(?:(?!\*\/)[\S\s])*\*\//g,"").replace(/<!--(?:(?!-->)[\S\s])*-->/g,"").replace(/\/\/.*/g,"").replace(/<style[^>]*>(?:(?!<\/style>)[\S\s])*<\/style>/g,"").replace(/import.*from\s*COMPLETE-STRING--\d+--/g,"").replace(/import\s*(?:COMPLETE-STRING--\d+--|\([^;\s]*\))/g,"").replace(/(?:require|import)\([^;\s]*\)/g,"").replace(/(?:@.*\n)+(?:export|function|class)/g,"")),H=t=>{let r=$(t),s=A(t,r),e=/{(.*)}/,i;for(;(i=e.exec(s))!==null;)return i[1].split(";").find(n=>_(n))!==void 0;return _(s)||V(t)},_=t=>!t||!t.match(/(?:\S*\{\S*\})|(?:^[\w\-()]+:\S+)|(?:^[\w-]+\(\S+\))|(?:^[@~]\S+$)|(?:^[\w-]+)/)&&!t.match(/center-content/)&&!t.match(/^(?:calc\(.*\)|\d+(?:%|ch|cm|em|ex|in|mm|pc|pt|px|rem|vh|vmax|vmin|vw|deg|grad|rad|turn|s)?)x(?:calc\(.*\)|\d+(?:%|ch|cm|em|ex|in|mm|pc|pt|px|rem|vh|vmax|vmin|vw|deg|grad|rad|turn|s)?)$/)||t.match(/\*\*/)||t.match(/:\[/)||t.match(/\$\{/)||t.match(/\{\{/)||t.match(/\(\{[^}]*\}/)||t.match(/<\w+>|<\/\w+>/)||t.match(/;$/)||t.match(/^\w+:\/\//)||t.match(/^@(?:ts-[^\s]+|charset|import|namespace|media|supports|document|page|font-face|keyframes|counter-style|font-feature-values|property|layer|[^/]+\/.*)$/)||t.match(/^~\/.+.\w+$/)||t.match(/function\(|\(.*\)=>/)||t.match(/^\$\(.*/)||t.match(/^COMPLETE-STRING--/),V=t=>{let r=[],s;for(let e=0;e<t.length;e++)switch(t[e]){case"(":case"[":case"{":r.push(t[e]);break;case")":case"]":case"}":if(s=r.pop(),t[e]===")"&&s!=="("||t[e]==="]"&&s!=="["||t[e]==="}"&&s!=="{")return!0;break}return r.length>0};var m=d(require("fs")),w=require("minimatch"),a=d(require("@techor/log")),S=require("@techor/extend"),E=d(require("explore-config")),O=require("@master/css-validator"),R=d(require("chokidar")),I=require("node:events");function P(t){if(typeof CSS<"u")return CSS.escape(t);if(arguments.length==0)throw new TypeError("`CSS.escape` requires an argument.");let r=String(t),s=r.length,e=-1,i="",o,n=r.charCodeAt(0);if(s==1&&n==45)return"\\"+r;for(;++e<s;){if(o=r.charCodeAt(e),o==0){i+="\uFFFD";continue}if(o>=1&&o<=31||o==127||e==0&&o>=48&&o<=57||e==1&&o>=48&&o<=57&&n==45){i+="\\"+o.toString(16)+" ";continue}if(o>=128||o==45||o==95||o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122){i+=r.charAt(e);continue}i+="\\"+r.charAt(e)}return i}var p=require("@techor/glob"),l=d(require("path")),f=class extends I.EventEmitter{constructor(s="master.css-extractor.*",e=process.cwd()){super();this.customOptions=s;this.cwd=e}css;latentClasses=new Set;validClasses=new Set;invalidClasses=new Set;options;watching=!1;watchers=[];init(s=this.customOptions){return typeof s=="string"||Array.isArray(s)?this.options=(0,S.extend)(u,(0,E.default)(s,{on:{found:e=>a.default.ok`**${e}** file found`,notFound:()=>a.default.i`No **${s}** file found`},cwd:this.cwd}),s):this.options=(0,S.extend)(u,s),this.options.verbose>1&&(a.default.ok`**options**`,a.default.tree(this.options),a.default``),this.css=new F.default(typeof this.options.config=="object"?this.options.config:(0,E.default)(this.options.config,{cwd:this.cwd})||{}),this.emit("init",this.options,this.config),this}async reset(s=this.customOptions){return this.watching&&await this.disableWatch(),this.latentClasses.clear(),this.validClasses.clear(),this.invalidClasses.clear(),this.init(s),await this.prepare(),this.watching&&await this.initWatch(),this.emit("reset"),this}async destroy(){return this.latentClasses.clear(),this.validClasses.clear(),this.invalidClasses.clear(),this.removeAllListeners(),await this.closeWatch(),this.emit("destroy"),this}async prepare(){if(this.options.classes?.fixed?.length){for(let s of this.options.classes.fixed)this.css.insert(s);this.options.verbose&&a.default.ok`${this.options.classes.fixed.length} fixed classes inserted ${this.options.classes.fixed}`}await this.insertFiles(this.fixedSourcePaths)}extract(s,e){if(!s||!e||!this.isSourceAllowed(s))return[];let i=[];for(let o of g(e))this.latentClasses.has(o)||(this.latentClasses.add(o),i.push(o));return i}async insert(s,e){if(!e)return!1;let i=this.extract(s,e);if(!i.length)return!1;this.invalidClasses.size&&(i=i.filter(c=>!this.invalidClasses.has(c))),this.validClasses.size&&(i=i.filter(c=>!this.validClasses.has(c))),this.options.classes?.ignored?.length&&(i=i.filter(c=>{for(let h of this.options.classes.ignored)if(typeof h=="string"){if(h===c)return!1}else if(h.test(c))return!1;return!0}));let o=process.hrtime(),n=[];await Promise.all(i.map(async c=>{let h=(0,O.createValidRules)(c,{css:this.css});h.length?(this.css.insertRules(h),n.push(c),this.validClasses.add(c)):this.invalidClasses.add(c)})),o=process.hrtime(o);let v=Math.round((o[0]*1e9+o[1])/1e6*10)/10;return this.css.rules.length&&n.length&&(this.options.verbose&&a.default.ok`**${l.default.relative(this.cwd,s)}** ${n.length} classes inserted ${a.chalk.gray("in")} ${v}ms ${this.options.verbose>1?n:""}`,this.emit("change")),!0}insertFile(s){return this.insert(s,m.default.readFileSync(l.default.resolve(this.cwd,s),{encoding:"utf-8"}).toString())}insertFiles(s){return Promise.all(s.map(e=>this.insertFile(e)))}export(s=this.options.module){let e=l.default.resolve(this.cwd,s),i=l.default.dirname(e);m.default.existsSync(i)||m.default.mkdirSync(i,{recursive:!0}),m.default.writeFileSync(e,this.css.text),this.options.verbose&&a.default.success`${this.css.rules.length} rules exported ${a.chalk.gray("in")} **${s}**`,this.emit("export",s,e)}watchSource(s,e){this.watch("add change",s,i=>this.insertFile(i),e)}watch(s,e,i,o){o=(0,S.extend)({ignoreInitial:!0,cwd:this.cwd},o);let n=R.default.watch(e,o);this.watchers.push(n),s.split(" ").forEach(v=>n.on(v,i))}initWatch(){let s=this.resolvedConfigPath,e=this.resolvedOptionsPath;this.options.sources&&this.watchSource(this.options.sources),s&&this.watch("add change unlink",s,async()=>{this.options.verbose&&(a.default``,a.default.t`[change] **${this.configPath}**`),await this.reset(),this.emit("configChange")}),e&&this.watch("add change unlink",e,async()=>{this.options.verbose&&(a.default``,a.default.t`[change] **${this.customOptions}**`),await this.reset(),this.emit("optionsChange")})}async disableWatch(){this.watchers.length&&(await Promise.all(this.watchers.map(s=>s.removeAllListeners())),this.watchers.length=0)}async startWatch(){this.watching||(this.initWatch(),this.watching=!0,this.emit("watchStart"))}async closeWatch(){this.watching&&(this.watchers.length&&(await Promise.all(this.watchers.map(s=>s.close())),this.watchers.length=0),this.watching=!1,this.emit("watchClose"))}get fixedSourcePaths(){let{sources:s}=this.options;return s?.length?(0,p.explorePathsSync)(s,{cwd:this.cwd}).filter(e=>!!e):[]}get resolvedFixedSourcePaths(){return this.fixedSourcePaths.map(s=>l.default.resolve(this.cwd,s))}get allowedSourcePaths(){let{include:s,exclude:e}=this.options;return s?.length?(0,p.explorePathsSync)(s,{cwd:this.cwd,ignore:e}).filter(i=>!!i):[]}get resolvedAllowedSourcePaths(){return this.allowedSourcePaths.map(s=>l.default.resolve(this.cwd,s))}isSourceAllowed(s){s.includes("?")&&(s=s.split("?")[0]);let{include:e,exclude:i,sources:o}=this.options;for(let n of o)if((0,w.minimatch)(s,n))return!0;for(let n of e)if(!(0,w.minimatch)(s,n))return!1;for(let n of i)if((0,w.minimatch)(s,n))return!1;return!0}get config(){return this.css.config}get configPath(){if(typeof this.options.config=="string"||Array.isArray(this.options.config))return(0,p.explorePathSync)(this.options.config,{cwd:this.cwd})}get resolvedConfigPath(){let s=this.configPath;if(s)return l.default.resolve(this.cwd,s)}get optionsPath(){if(typeof this.customOptions=="string"||Array.isArray(this.customOptions))return(0,p.explorePathSync)(this.customOptions,{cwd:this.cwd})}get resolvedOptionsPath(){let s=this.optionsPath;if(s)return l.default.resolve(this.cwd,s)}get resolvedVirtualModuleId(){return"\0"+this.options.module}get slotCSSRule(){return"#"+P(this.options.module)+"{--slot:0}"}};0&&(module.exports={CSSExtractor,OPTIONS_ESM_TEXT,OPTIONS_TEXT,extractLatentClasses,options});
